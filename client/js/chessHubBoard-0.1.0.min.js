/*! chess-hub 2014-03-27 */
var CHESSBOARD={chessBoardColumnsBlack:{1:"h",2:"g",3:"f",4:"e",5:"d",6:"c",7:"b",8:"a"},chessBoardColumnsWhite:{1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h"},chessBoardColumns:{1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h"},chessBoardRowsBlack:[1,2,3,4,5,6,7,8],chessBoardRowsWhite:[8,7,6,5,4,3,2,1],chessBoardRows:[8,7,6,5,4,3,2,1],colors:{w:"white",b:"black"},promoting:{w:!1,b:!1},arrayOfMoves:[],pieces:[],gameId:"",gameTimer:0,selectedPiece:"",playerA:"",playerB:"",blackPlayer:"",blackTimer:0,blackCanCastleKingSide:!0,blackCanCastleQueenSide:!0,whitePlayer:"",whiteTimer:0,whiteCanCastleKingSide:!0,whiteCanCastleQueenSide:!0,timer:"",timerInterval:"",currentGameTurn:"",gameHistory:[],counter:0,chessBoard:{11:"",12:"",13:"",14:"",15:"",16:"",17:"",18:"",21:"",22:"",23:"",24:"",25:"",26:"",27:"",28:"",31:"",32:"",33:"",34:"",35:"",36:"",37:"",38:"",41:"",42:"",43:"",44:"",45:"",46:"",47:"",48:"",51:"",52:"",53:"",54:"",55:"",56:"",57:"",58:"",61:"",62:"",63:"",64:"",65:"",66:"",67:"",68:"",71:"",72:"",73:"",74:"",75:"",76:"",77:"",78:"",81:"",82:"",83:"",84:"",85:"",86:"",87:"",88:""},numericColumns:{a:10,b:20,c:30,d:40,e:50,f:60,g:70,h:80},unnumericColumns:{1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h"},_numeric:function(a){var b=parseInt(CHESSBOARD.numericColumns[a[2]],10)+parseInt(a[3],10);return b},_unnumeric:function(a){var b=a+"";return"sq"+CHESSBOARD.unnumericColumns[b[0]]+b[1]},_markSquare:function(a,b,c){if(c){try{"ALL"===a?$(".chessBoardSquare").addClass(b):$("#"+a).addClass(b)}catch(d){return console.log(a+" cannot be marked as "+b),!1}return!0}try{"ALL"===a?$(".chessBoardSquare").removeClass(b):$("#"+a).removeClass(b)}catch(d){return console.log(a+" cannot be unmarked as "+b),!1}return!0},updateTimers:function(a,b){CHESSBOARD.whiteTimer=a,CHESSBOARD.blackTimer=b,CHESSBOARD.updateTimer("w",CHESSBOARD.whiteTimer),CHESSBOARD.updateTimer("b",CHESSBOARD.blackTimer)},updateTimer:function(a,b){var c=0,d=0;b>0&&(c=Math.floor(b/60),d=b-60*c);var e=(10>c?"0":"")+c+":"+(10>d?"0":"")+d;$("#"+a+"Timer").html(e)},startTimer:function(a){CHESSBOARD.stopTimer(),"w"===a?($("#wTimer").addClass("current"),CHESSBOARD.gameTimer>0&&(CHESSBOARD.timerInterval=setInterval(function(){CHESSBOARD.whiteTimer>0&&(CHESSBOARD.whiteTimer=CHESSBOARD.whiteTimer-1),CHESSBOARD.updateTimer(a,CHESSBOARD.whiteTimer)},1e3))):"b"===a&&($("#bTimer").addClass("current"),CHESSBOARD.gameTimer>0&&(CHESSBOARD.timerInterval=setInterval(function(){CHESSBOARD.blackTimer>0&&(CHESSBOARD.blackTimer=CHESSBOARD.blackTimer-1),CHESSBOARD.updateTimer(a,CHESSBOARD.blackTimer)},1e3)))},stopTimer:function(){clearInterval(CHESSBOARD.timerInterval),$(".timer").removeClass("current")},move:function(a,b,c,d){var e=CHESSBOARD.pieces[a].sqId,f=parseInt(CHESSBOARD._numeric(e),10),g=parseInt(CHESSBOARD._numeric(b),10),h=g-f;!d&&("w"===a[0]&&CHESSBOARD.whitePlayer===CONTEXT.user&&"w"===CHESSBOARD.currentGameTurn||"b"===a[0]&&CHESSBOARD.blackPlayer===CONTEXT.user&&"b"===CHESSBOARD.currentGameTurn)&&CHESSBOARD.arrayOfMoves.push("move-"+a+"-"+b);var i=$("#"+b),j=$("#"+a);if("wking"===a?(CHESSBOARD.whiteCanCastleKingSide=!1,CHESSBOARD.whiteCanCastleQueenSide=!1):"bking"===a?(CHESSBOARD.blackCanCastleKingSide=!1,CHESSBOARD.blackCanCastleQueenSide=!1):"wrooka"===a?CHESSBOARD.whiteCanCastleQueenSide=!1:"wrookh"===a?CHESSBOARD.whiteCanCastleKingSide=!1:"brooka"===a?CHESSBOARD.blackCanCastleQueenSide=!1:"brookh"===a&&(CHESSBOARD.blackCanCastleKingSide=!1),"s"===b[0]){var k=CHESSBOARD.chessBoard[CHESSBOARD._numeric(b)];""!==k&&CHESSBOARD.move(k,CHESSBOARD.pieces[k].id[0]+"Graveyard",!0)}if(("wpawn"===CHESSBOARD.pieces[a].class&&"2"===CHESSBOARD.pieces[a].sqId[3]&&"4"===b[3]||"bpawn"===CHESSBOARD.pieces[a].class&&"7"===CHESSBOARD.pieces[a].sqId[3]&&"5"===b[3])&&(CHESSBOARD.pieces[a].enPassant=!0),!CHESSBOARD.chessBoard[g]&&"wpawn"===CHESSBOARD.pieces[a].class&&"5"===CHESSBOARD.pieces[a].sqId[3]&&CHESSBOARD.chessBoard[g-1]&&(11===h||-9===h)){var k=CHESSBOARD.chessBoard[g-1];""!==k&&CHESSBOARD.move(k,CHESSBOARD.pieces[k].id[0]+"Graveyard",!0)}if(!CHESSBOARD.chessBoard[g]&&"bpawn"===CHESSBOARD.pieces[a].class&&"4"===CHESSBOARD.pieces[a].sqId[3]&&CHESSBOARD.chessBoard[g+1]&&(-11===h||9===h)){var k=CHESSBOARD.chessBoard[g+1];""!==k&&CHESSBOARD.move(k,CHESSBOARD.pieces[k].id[0]+"Graveyard",!0)}CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.pieces[a].sqId)]="","s"===b[0]&&(CHESSBOARD.chessBoard[CHESSBOARD._numeric(b)]=a);var l=.05*i.width();if(j.animate({top:"+="+(i.position().top-j.position().top)+"px",left:"+="+(i.position().left-j.position().left+l)+"px"},"fast",void 0,function(){j.prependTo(i),j.css({top:"0px",left:"0px"})}),CHESSBOARD.pieces[a].sqId=b,!c){CHESSBOARD._commitMoves(CHESSBOARD.gameId),CHESSBOARD.currentGameTurn="w"===a[0]?"b":"w";for(var m in CHESSBOARD.pieces)CHESSBOARD.pieces[m].class===CHESSBOARD.currentGameTurn+"pawn"&&CHESSBOARD.pieces[m].enPassant===!0&&(CHESSBOARD.pieces[m].enPassant=!1);CHESSBOARD.startTimer(CHESSBOARD.currentGameTurn)}CHESSBOARD._verifyCheck()},flip:function(a){if("w"===a)CHESSBOARD.chessBoardColumns=CHESSBOARD.chessBoardColumnsWhite,CHESSBOARD.chessBoardRows=CHESSBOARD.chessBoardRowsWhite;else if("b"===a)CHESSBOARD.chessBoardColumns=CHESSBOARD.chessBoardColumnsBlack,CHESSBOARD.chessBoardRows=CHESSBOARD.chessBoardRowsBlack;else{var b={1:CHESSBOARD.chessBoardColumns[8],2:CHESSBOARD.chessBoardColumns[7],3:CHESSBOARD.chessBoardColumns[6],4:CHESSBOARD.chessBoardColumns[5],5:CHESSBOARD.chessBoardColumns[4],6:CHESSBOARD.chessBoardColumns[3],7:CHESSBOARD.chessBoardColumns[2],8:CHESSBOARD.chessBoardColumns[1]};CHESSBOARD.chessBoardColumns=b,CHESSBOARD.chessBoardRows.reverse()}$("#chessBoard").empty(),$("#wGraveyard").empty(),$("#bGraveyard").empty(),CHESSBOARD._drawBoard(),CHESSBOARD._spawnPieces()},mouseDownHandler:function(a){a.stopPropagation();if("IMG"===a.target.tagName&&!CHESSBOARD.selectedPiece&&("wGraveyard"===CHESSBOARD.pieces[a.target.id].sqId&&CHESSBOARD.whitePlayer===CONTEXT.user&&CHESSBOARD.promoting.w||"bGraveyard"===CHESSBOARD.pieces[a.target.id].sqId&&CHESSBOARD.blackPlayer===CONTEXT.user&&CHESSBOARD.promoting.b)){CHESSBOARD.selectedPiece=$("#"+a.target.id),CHESSBOARD._markSquare(CHESSBOARD.pieces[a.target.id].sqId,"selected",!1);var b=CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.promoting[a.target.id[0]])];return""!==b&&CHESSBOARD.move(b,CHESSBOARD.pieces[b].id[0]+"Graveyard",!0),CHESSBOARD.move(a.target.id,CHESSBOARD.promoting[a.target.id[0]]),CHESSBOARD.selectedPiece="",CHESSBOARD.promoting[a.target.id[0]]=!1,!0}if("IMG"===a.target.tagName&&!CHESSBOARD.selectedPiece&&("wGraveyard"!==CHESSBOARD.pieces[a.target.id].sqId&&CHESSBOARD.whitePlayer===CONTEXT.user&&CHESSBOARD.promoting.w||"bGraveyard"!==CHESSBOARD.pieces[a.target.id].sqId&&CHESSBOARD.blackPlayer===CONTEXT.user&&CHESSBOARD.promoting.b))return!1;if("IMG"===a.target.tagName&&!CHESSBOARD.selectedPiece&&(a.target.id[0]!==CHESSBOARD.currentGameTurn||"wGraveyard"===CHESSBOARD.pieces[a.target.id].sqId||"bGraveyard"===CHESSBOARD.pieces[a.target.id].sqId||"w"===a.target.id[0]&&CHESSBOARD.whitePlayer!==CONTEXT.user||"b"===a.target.id[0]&&CHESSBOARD.blackPlayer!==CONTEXT.user))return!1;if("IMG"!==a.target.tagName||CHESSBOARD.selectedPiece){if("IMG"===a.target.tagName&&CHESSBOARD.selectedPiece&&CHESSBOARD.selectedPiece.attr("id")!==a.target.id&&CHESSBOARD.selectedPiece.attr("id")[0]===a.target.id[0])return CHESSBOARD._markSquare(CHESSBOARD.pieces[CHESSBOARD.selectedPiece.attr("id")].sqId,"selected",!1),CHESSBOARD.selectedPiece=$("#"+a.target.id),CHESSBOARD._markSquare(CHESSBOARD.pieces[a.target.id].sqId,"selected",!0),!0;if("IMG"===a.target.tagName&&CHESSBOARD.selectedPiece&&CHESSBOARD.selectedPiece.attr("id")===a.target.id)return CHESSBOARD._markSquare(CHESSBOARD.pieces[CHESSBOARD.selectedPiece.attr("id")].sqId,"selected",!1),CHESSBOARD.selectedPiece="",!0;if(("DIV"===a.target.tagName||"IMG"===a.target.tagName&&CHESSBOARD.selectedPiece.attr("id")[0]!==a.target.id[0]&&""!==CHESSBOARD.pieces[a.target.id].sqId)&&CHESSBOARD.selectedPiece){for(var c=a.target,d=CHESSBOARD.selectedPiece.attr("id");"DIV"!==c.tagName;)c=c.parentNode;var e=CHESSBOARD._canMove(d,c.id);if(!e)return!1;if(CHESSBOARD._isCheck(d,c.id))return!1;if("bking"===d||"wking"===d){var f=CHESSBOARD.pieces[d].sqId,g=parseInt(CHESSBOARD._numeric(f),10),h=parseInt(CHESSBOARD._numeric(c.id),10),i=h-g,j="",k="";20===i&&CHESSBOARD.whiteCanCastleKingSide&&"w"===d[0]?(j="wrookh",k="sqf1"):20===i&&CHESSBOARD.blackCanCastleKingSide&&"b"===d[0]?(j="brookh",k="sqf8"):-20===i&&CHESSBOARD.whiteCanCastleQueenSide&&"w"===d[0]?(j="wrooka",k="sqd1"):-20===i&&CHESSBOARD.blackCanCastleQueenSide&&"b"===d[0]&&(j="brooka",k="sqd8"),j&&k&&CHESSBOARD.move(j,k,!0)}return("wpawn"===CHESSBOARD.pieces[d].class&&"8"===c.id[3]||"bpawn"===CHESSBOARD.pieces[d].class&&"1"===c.id[3])&&document.getElementById(d[0]+"Graveyard").children.length&&(CHESSBOARD.promoting[d[0]]=c.id,CHESSBOARD._markSquare(d[0]+"Graveyard","selected",!0)),CHESSBOARD._markSquare(CHESSBOARD.pieces[CHESSBOARD.selectedPiece.attr("id")].sqId,"selected",!1),CHESSBOARD.move(d,c.id,CHESSBOARD.promoting[d[0]]?!0:!1),CHESSBOARD.selectedPiece="",!0}return console.log("Unhandled case : "+a.target.id),!1}return CHESSBOARD.selectedPiece=$("#"+a.target.id),CHESSBOARD._markSquare(CHESSBOARD.pieces[a.target.id].sqId,"selected",!0),!0},_commitMoves:function(){CHESSBOARD.arrayOfMoves.length>0&&CHESSHUB.sendMessage(JSON.stringify(CHESSBOARD.arrayOfMoves),CHESSBOARD.gameId,"game",function(){},function(a){console.log("error sending move"),console.log(a)}),CHESSBOARD.arrayOfMoves=[]},_canMove:function(a,b,c){var d=0,e="",f=CHESSBOARD.chessBoard[CHESSBOARD._numeric(b)],g=CHESSBOARD.pieces[a].sqId,h=parseInt(CHESSBOARD._numeric(g),10),i=parseInt(CHESSBOARD._numeric(b),10),j=i-h;switch(CHESSBOARD.pieces[a].type){case"pawn":return c||"w"!==a[0]||1!==j&&(2!==j||"2"!==g[3])?c||"b"!==a[0]||-1!==j&&(-2!==j||"7"!==g[3])?("w"===a[0]&&(11===j||-9===j)||"b"===a[0]&&(-11===j||9===j))&&(f||"wpawn"===CHESSBOARD.pieces[a].class&&"6"===b[3]&&CHESSBOARD.chessBoard[i-1]&&"bpawn"===CHESSBOARD.pieces[CHESSBOARD.chessBoard[i-1]].class&&CHESSBOARD.pieces[CHESSBOARD.chessBoard[i-1]].enPassant||"bpawn"===CHESSBOARD.pieces[a].class&&"3"===b[3]&&CHESSBOARD.chessBoard[i+1]&&"wpawn"===CHESSBOARD.pieces[CHESSBOARD.chessBoard[i+1]].class&&CHESSBOARD.pieces[CHESSBOARD.chessBoard[i+1]].enPassant)?!0:!1:f?!1:-2===j&&CHESSBOARD.chessBoard[h-1]?!1:!0:f?!1:2===j&&CHESSBOARD.chessBoard[h+1]?!1:!0;case"knight":return 21===j||-21===j||19===j||-19===j||12===j||-12===j||8===j||-8===j?!0:!1;case"bishop":if(j%11===0&&j>0&&parseInt(g[3],10)<parseInt(b[3],10)&&g[2]<b[2]||j%11===0&&0>j&&parseInt(g[3],10)>parseInt(b[3],10)&&g[2]>b[2]||j%9===0&&j>0&&parseInt(g[3],10)>parseInt(b[3],10)&&g[2]<b[2]||j%9===0&&0>j&&parseInt(g[3],10)<parseInt(b[3],10)&&g[2]>b[2]){for(j%11===0&&j>0?d=11:j%11===0&&0>j?d=-11:j%9===0&&j>0?d=9:j%9===0&&0>j&&(d=-9),e=h+d;i>e&&j>0||e>i&&0>j;e+=d)if(CHESSBOARD.chessBoard[e])return!1;return!0}return!1;case"rook":if(g[2]===b[2]||g[3]===b[3]){for(g[2]===b[2]&&j>0?d=1:g[2]===b[2]&&0>j?d=-1:g[3]===b[3]&&j>0?d=10:g[3]===b[3]&&0>j&&(d=-10),e=h+d;i>e&&j>0||e>i&&0>j;e+=d)if(CHESSBOARD.chessBoard[e])return!1;return!0}break;case"queen":if(j%11===0&&j>0&&parseInt(g[3],10)<parseInt(b[3],10)&&g[2]<b[2]||j%11===0&&0>j&&parseInt(g[3],10)>parseInt(b[3],10)&&g[2]>b[2]||j%9===0&&j>0&&parseInt(g[3],10)>parseInt(b[3],10)&&g[2]<b[2]||j%9===0&&0>j&&parseInt(g[3],10)<parseInt(b[3],10)&&g[2]>b[2]||g[2]===b[2]||g[3]===b[3]){for(j%11===0&&j>0?d=11:j%11===0&&0>j?d=-11:j%9===0&&j>0?d=9:j%9===0&&0>j?d=-9:g[2]===b[2]&&j>0?d=1:g[2]===b[2]&&0>j?d=-1:g[3]===b[3]&&j>0?d=10:g[3]===b[3]&&0>j&&(d=-10),e=h+d;i>e&&j>0||e>i&&0>j;e+=d)if(CHESSBOARD.chessBoard[e])return!1;return!0}break;case"king":if(d=0,1===j||-1===j||-11===j||11===j||-9===j||9===j||-10===j||10===j)return CHESSBOARD._isCheck(a,b)?!1:!0;if(CHESSBOARD._isCheck(a,g)||CHESSBOARD._isCheck(a,b))return!1;if(20===j&&CHESSBOARD.whiteCanCastleKingSide&&"w"===a[0]?d=10:20===j&&CHESSBOARD.blackCanCastleKingSide&&"b"===a[0]?d=10:-20===j&&CHESSBOARD.whiteCanCastleQueenSide&&"w"===a[0]?d=-10:-20===j&&CHESSBOARD.blackCanCastleQueenSide&&"b"===a[0]&&(d=-10),!d)return!1;for(e=h+d;i>=e&&j>0||e>=i&&0>j;e+=d)if(CHESSBOARD.chessBoard[e])return!1;return!0}return!1},_isCheck:function(a,b){var c=a[0],d=!1,e=CHESSBOARD.pieces[a].sqId,f=CHESSBOARD.chessBoard[CHESSBOARD._numeric(b)];if(CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.pieces[a].sqId)]="",CHESSBOARD.pieces[a].sqId=b,CHESSBOARD.chessBoard[CHESSBOARD._numeric(b)]=a,f&&(CHESSBOARD.pieces[f].sqId="out"),"wking"===a||"bking"===a)for(var g in CHESSBOARD.pieces)"king"!==CHESSBOARD.pieces[g].type&&"s"===CHESSBOARD.pieces[g].sqId[0]&&g[0]!==a[0]&&CHESSBOARD._canMove(g,b,!0)&&(d=g);else d=CHESSBOARD._isCheck(c+"king",CHESSBOARD.pieces[c+"king"].sqId)?!0:!1;return f&&(CHESSBOARD.pieces[f].sqId=b),CHESSBOARD.chessBoard[CHESSBOARD._numeric(e)]=a,CHESSBOARD.chessBoard[CHESSBOARD._numeric(b)]=f,CHESSBOARD.pieces[a].sqId=e,d},_verifyCheck:function(){var a=["bking","wking"];return CHESSBOARD._markSquare("ALL","check",!1),a.forEach(function(a){var b=CHESSBOARD._isCheck(a,CHESSBOARD.pieces[a].sqId);b?(CHESSBOARD._markSquare(CHESSBOARD.pieces[a].sqId,"check",!0),CHESSBOARD._markSquare(CHESSBOARD.pieces[b].sqId,"check",!0),CHESSBOARD.pieces[a].isCheck=!0):(CHESSBOARD._markSquare(CHESSBOARD.pieces[a].sqId,"check",!1),CHESSBOARD.pieces[a].isCheck=!1)}),!1},_createPieces:function(){for(var a in CHESSBOARD.colors){CHESSBOARD.pieces[a+"king"]={id:a+"king",type:"king",order:0,name:CHESSBOARD.colors[a]+" king","class":a+"king",sqId:"sqe"+("w"===a?1:8),initx:5,inity:"w"===a?1:8,isCheck:!1},CHESSBOARD.pieces[a+"queen"]={id:a+"queen",type:"queen",order:1,name:CHESSBOARD.colors[a]+" queen","class":a+"queen",sqId:"sqd"+("w"===a?1:8),initx:4,inity:"w"===a?1:8},CHESSBOARD.pieces[a+"rooka"]={id:a+"rooka",type:"rook",order:2,name:CHESSBOARD.colors[a]+" rook (a)","class":a+"rook",sqId:"sqa"+("w"===a?1:8),initx:1,inity:"w"===a?1:8},CHESSBOARD.pieces[a+"rookh"]={id:a+"rookh",type:"rook",order:3,name:CHESSBOARD.colors[a]+" rook (h)","class":a+"rook",sqId:"sqh"+("w"===a?1:8),initx:8,inity:"w"===a?1:8},CHESSBOARD.pieces[a+"knightb"]={id:a+"knightb",type:"knight",order:4,name:CHESSBOARD.colors[a]+" knight (b)","class":a+"knight",sqId:"sqb"+("w"===a?1:8),initx:2,inity:"w"===a?1:8},CHESSBOARD.pieces[a+"knightg"]={id:a+"knightg",type:"knight",order:2,name:CHESSBOARD.colors[a]+" knight (g)","class":a+"knight",sqId:"sqg"+("w"===a?1:8),initx:7,inity:"w"===a?1:8},CHESSBOARD.pieces[a+"bishopc"]={id:a+"bishopc",type:"bishop",order:6,name:CHESSBOARD.colors[a]+" bishop (c)","class":a+"bishop",sqId:"sqc"+("w"===a?1:8),initx:3,inity:"w"===a?1:8},CHESSBOARD.pieces[a+"bishopf"]={id:a+"bishopf",type:"bishop",order:7,name:CHESSBOARD.colors[a]+" bishop (f)","class":a+"bishop",sqId:"sqf"+("w"===a?1:8),initx:6,inity:"w"===a?1:8};for(var b in CHESSBOARD.chessBoardColumns)CHESSBOARD.pieces[a+"pawn"+CHESSBOARD.chessBoardColumns[b]]={id:a+"pawn"+CHESSBOARD.chessBoardColumns[b],type:"pawn",order:7+b,name:CHESSBOARD.colors[a]+" pawn ("+CHESSBOARD.chessBoardColumns[b]+")","class":a+"pawn",sqId:"sq"+CHESSBOARD.chessBoardColumns[b]+("w"===a?2:7),initx:b,inity:"w"===a?2:7}}CHESSBOARD.chessBoard={11:"",12:"",13:"",14:"",15:"",16:"",17:"",18:"",21:"",22:"",23:"",24:"",25:"",26:"",27:"",28:"",31:"",32:"",33:"",34:"",35:"",36:"",37:"",38:"",41:"",42:"",43:"",44:"",45:"",46:"",47:"",48:"",51:"",52:"",53:"",54:"",55:"",56:"",57:"",58:"",61:"",62:"",63:"",64:"",65:"",66:"",67:"",68:"",71:"",72:"",73:"",74:"",75:"",76:"",77:"",78:"",81:"",82:"",83:"",84:"",85:"",86:"",87:"",88:""};for(var c in CHESSBOARD.pieces)CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.pieces[c].sqId)]=CHESSBOARD.pieces[c].id},_spawnPieces:function(){var a=$("#bGraveyard"),b=$("#wGraveyard");for(var c in CHESSBOARD.pieces){var d='<img                         class="piece '+CHESSBOARD.pieces[c].class+'"                         src="/client/img/transparent.png"                         alt="'+CHESSBOARD.pieces[c].name+'"                         title="'+CHESSBOARD.pieces[c].name+'"                         id="'+CHESSBOARD.pieces[c].id+'">                   </img>';"w"===CHESSBOARD.pieces[c].id[0]&&""===CHESSBOARD.pieces[c].sqId?b.append(d):"b"===CHESSBOARD.pieces[c].id[0]&&""===CHESSBOARD.pieces[c].sqId?a.append(d):$("#"+CHESSBOARD.pieces[c].sqId).append(d)}$(".piece").bind("vmousedown",function(a){CHESSBOARD.mouseDownHandler(a)}).on("dragstart",function(a){a.preventDefault()})},_drawBoard:function(){var a=$("#chessBoard");for(var b in CHESSBOARD.chessBoardRows){var c='<div class="chessBoardRow">';for(var d in CHESSBOARD.chessBoardColumns)c+='<div title="'+CHESSBOARD.chessBoardColumns[d]+CHESSBOARD.chessBoardRows[b]+'"                             id="sq'+CHESSBOARD.chessBoardColumns[d]+CHESSBOARD.chessBoardRows[b]+'"                             class="chessBoardSquare chessBoardSquare'+(parseInt(d,10)+parseInt(b,10))%2+'"></div>';c+="</div>",a.append(c)}$(".chessBoardSquare").bind("vmousedown",function(a){CHESSBOARD.mouseDownHandler(a)})},initChessBoard:function(a){return CHESSBOARD.pieces=[],$("#chessBoard").empty(),$("#wGraveyard").empty(),$("#bGraveyard").empty(),$("#board_chat_input").val(""),$("#wSit").css("display","block"),$("#bSit").css("display","block"),CHESSBOARD.stopTimer(),CHESSBOARD._drawBoard(),CHESSBOARD._createPieces(),CHESSBOARD._spawnPieces(),CHESSBOARD.gameId=a,CHESSBOARD.playerA="",CHESSBOARD.playerB="",CHESSBOARD.blackPlayer="",CHESSBOARD.blackCanCastleKingSide=!0,CHESSBOARD.blackCanCastleQueenSide=!0,CHESSBOARD.whitePlayer="",CHESSBOARD.whiteCanCastleKingSide=!0,CHESSBOARD.whiteCanCastleQueenSide=!0,CHESSBOARD.currentGameTurn="",CHESSBOARD.gameHistory=[],CHESSBOARD.counter=0,0},sit:function(a){return $("#"+a+"Sit").css("display","none"),CHESSHUB.sendMessage("sit-"+a,CHESSBOARD.gameId,"game",function(){CHESSBOARD.setPlayer(a,CONTEXT.user),CHESSBOARD.flip(a)},function(){console.log("error while sitting")}),!0},setPlayer:function(a,b){"A"===a?CHESSBOARD.playerA=b:"B"===a?CHESSBOARD.playerB=b:"w"===a?(CHESSBOARD.whitePlayer=b,b?$("#wSit").css("display","none"):(CHESSBOARD.stopTimer(),$("#wSit").css("display","block"))):"b"===a&&(CHESSBOARD.blackPlayer=b,b?$("#bSit").css("display","none"):(CHESSBOARD.stopTimer(),$("#bSit").css("display","block"))),CHESSBOARD.blackPlayer&&CHESSBOARD.whitePlayer&&(CHESSBOARD.currentGameTurn||(CHESSBOARD.currentGameTurn="w",$("#wTimer").addClass("current")))}};