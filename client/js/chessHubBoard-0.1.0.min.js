/*! chess-hub 2013-05-16 */
var CHESSBOARD={chessBoardColumnsBlack:{1:"h",2:"g",3:"f",4:"e",5:"d",6:"c",7:"b",8:"a"},chessBoardColumnsWhite:{1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h"},chessBoardColumns:{1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h"},chessBoardRowsBlack:[1,2,3,4,5,6,7,8],chessBoardRowsWhite:[8,7,6,5,4,3,2,1],chessBoardRows:[8,7,6,5,4,3,2,1],colors:{w:"white",b:"black"},promoting:{w:!1,b:!1},arrayOfMoves:[],pieces:[],gameId:"",gameTimer:0,selectedPiece:"",playerA:"",playerB:"",blackPlayer:"",blackTimer:0,blackCanCastleKingSide:!0,blackCanCastleQueenSide:!0,whitePlayer:"",whiteTimer:0,whiteCanCastleKingSide:!0,whiteCanCastleQueenSide:!0,timer:"",timerInterval:"",currentGameTurn:"",gameHistory:[],chessBoard:{11:"",12:"",13:"",14:"",15:"",16:"",17:"",18:"",21:"",22:"",23:"",24:"",25:"",26:"",27:"",28:"",31:"",32:"",33:"",34:"",35:"",36:"",37:"",38:"",41:"",42:"",43:"",44:"",45:"",46:"",47:"",48:"",51:"",52:"",53:"",54:"",55:"",56:"",57:"",58:"",61:"",62:"",63:"",64:"",65:"",66:"",67:"",68:"",71:"",72:"",73:"",74:"",75:"",76:"",77:"",78:"",81:"",82:"",83:"",84:"",85:"",86:"",87:"",88:""},numericColumns:{a:10,b:20,c:30,d:40,e:50,f:60,g:70,h:80},unnumericColumns:{1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h"},_numeric:function(e){var S=parseInt(CHESSBOARD.numericColumns[e[2]],10)+parseInt(e[3],10);return S},_unnumeric:function(e){var S=e+"";return"sq"+CHESSBOARD.unnumericColumns[S[0]]+S[1]},_markSquare:function(e,S,s){if(s){try{"ALL"===e?$(".chessBoardSquare").addClass(S):$("#"+e).addClass(S)}catch(r){return console.log(e+" cannot be marked as "+S),!1}return!0}try{"ALL"===e?$(".chessBoardSquare").removeClass(S):$("#"+e).removeClass(S)}catch(r){return console.log(e+" cannot be unmarked as "+S),!1}return!0},updateTimers:function(e,S){CHESSBOARD.whiteTimer=e,CHESSBOARD.blackTimer=S,CHESSBOARD.updateTimer("w",CHESSBOARD.whiteTimer),CHESSBOARD.updateTimer("b",CHESSBOARD.blackTimer)},updateTimer:function(e,S){var s=Math.floor(S/60),r=S-60*s,a=(10>s?"0":"")+s+":"+(10>r?"0":"")+r;$("#"+e+"Timer").html(a)},startTimer:function(e){CHESSBOARD.stopTimer(),"w"===e?CHESSBOARD.timerInterval=setInterval(function(){CHESSBOARD.whiteTimer=CHESSBOARD.whiteTimer-1,CHESSBOARD.updateTimer(e,CHESSBOARD.whiteTimer)},1e3):"b"===e&&(CHESSBOARD.timerInterval=setInterval(function(){CHESSBOARD.blackTimer=CHESSBOARD.blackTimer-1,CHESSBOARD.updateTimer(e,CHESSBOARD.blackTimer)},1e3))},stopTimer:function(){clearInterval(CHESSBOARD.timerInterval)},move:function(e,S,s){var r=CHESSBOARD.pieces[e].sqId,a=parseInt(CHESSBOARD._numeric(r),10),i=parseInt(CHESSBOARD._numeric(S),10),t=i-a;("w"===e[0]&&CHESSBOARD.whitePlayer===CONTEXT.user&&"w"===CHESSBOARD.currentGameTurn||"b"===e[0]&&CHESSBOARD.blackPlayer===CONTEXT.user&&"b"===CHESSBOARD.currentGameTurn)&&CHESSBOARD.arrayOfMoves.push("move-"+e+"-"+S);var n=$("#"+S),c=$("#"+e);if("wking"===e?(CHESSBOARD.whiteCanCastleKingSide=!1,CHESSBOARD.whiteCanCastleQueenSide=!1):"bking"===e?(CHESSBOARD.blackCanCastleKingSide=!1,CHESSBOARD.blackCanCastleQueenSide=!1):"wrooka"===e?CHESSBOARD.whiteCanCastleQueenSide=!1:"wrookh"===e?CHESSBOARD.whiteCanCastleKingSide=!1:"brooka"===e?CHESSBOARD.blackCanCastleQueenSide=!1:"brookh"===e&&(CHESSBOARD.blackCanCastleKingSide=!1),"s"===S[0]){var C=CHESSBOARD.chessBoard[CHESSBOARD._numeric(S)];""!==C&&CHESSBOARD.move(C,CHESSBOARD.pieces[C].id[0]+"Graveyard",!0)}if(("wpawn"===CHESSBOARD.pieces[e].class&&"2"===CHESSBOARD.pieces[e].sqId[3]&&"4"===S[3]||"bpawn"===CHESSBOARD.pieces[e].class&&"7"===CHESSBOARD.pieces[e].sqId[3]&&"5"===S[3])&&(CHESSBOARD.pieces[e].enPassant=!0),!CHESSBOARD.chessBoard[i]&&"wpawn"===CHESSBOARD.pieces[e].class&&CHESSBOARD.chessBoard[i-1]&&(11===t||-9===t)){var C=CHESSBOARD.chessBoard[i-1];""!==C&&CHESSBOARD.move(C,CHESSBOARD.pieces[C].id[0]+"Graveyard",!0)}if(!CHESSBOARD.chessBoard[i]&&"bpawn"===CHESSBOARD.pieces[e].class&&CHESSBOARD.chessBoard[i+1]&&(-11===t||9===t)){var C=CHESSBOARD.chessBoard[i+1];""!==C&&CHESSBOARD.move(C,CHESSBOARD.pieces[C].id[0]+"Graveyard",!0)}CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.pieces[e].sqId)]="","s"===S[0]&&(CHESSBOARD.chessBoard[CHESSBOARD._numeric(S)]=e);var B=.05*n.width();c.animate({top:"+="+(n.position().top-c.position().top)+"px",left:"+="+(n.position().left-c.position().left+B)+"px"},"fast",void 0,function(){c.prependTo(n),c.css({top:"0px",left:"0px"})}),CHESSBOARD.pieces[e].sqId=S,s||(CHESSBOARD._commitMoves(CHESSBOARD.gameId),CHESSBOARD.currentGameTurn="w"===e[0]?"b":"w",CHESSBOARD.gameTimer>0&&CHESSBOARD.startTimer(CHESSBOARD.currentGameTurn)),CHESSBOARD._verifyCheck()},flip:function(e){if("w"===e)CHESSBOARD.chessBoardColumns=CHESSBOARD.chessBoardColumnsWhite,CHESSBOARD.chessBoardRows=CHESSBOARD.chessBoardRowsWhite;else if("b"===e)CHESSBOARD.chessBoardColumns=CHESSBOARD.chessBoardColumnsBlack,CHESSBOARD.chessBoardRows=CHESSBOARD.chessBoardRowsBlack;else{var S={1:CHESSBOARD.chessBoardColumns[8],2:CHESSBOARD.chessBoardColumns[7],3:CHESSBOARD.chessBoardColumns[6],4:CHESSBOARD.chessBoardColumns[5],5:CHESSBOARD.chessBoardColumns[4],6:CHESSBOARD.chessBoardColumns[3],7:CHESSBOARD.chessBoardColumns[2],8:CHESSBOARD.chessBoardColumns[1]};CHESSBOARD.chessBoardColumns=S,CHESSBOARD.chessBoardRows.reverse()}$("#chessBoard").empty(),$("#wGraveyard").empty(),$("#bGraveyard").empty(),CHESSBOARD._drawBoard(),CHESSBOARD._spawnPieces()},mouseDownHandler:function(e){if(e.stopPropagation(),"IMG"===e.target.tagName&&!CHESSBOARD.selectedPiece&&("wGraveyard"===CHESSBOARD.pieces[e.target.id].sqId&&CHESSBOARD.whitePlayer===CONTEXT.user&&CHESSBOARD.promoting.w||"bGraveyard"===CHESSBOARD.pieces[e.target.id].sqId&&CHESSBOARD.blackPlayer===CONTEXT.user&&CHESSBOARD.promoting.b)){CHESSBOARD.selectedPiece=$("#"+e.target.id),CHESSBOARD._markSquare(CHESSBOARD.pieces[e.target.id].sqId,"selected",!1);var S=CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.promoting[e.target.id[0]])];return""!==S&&CHESSBOARD.move(S,CHESSBOARD.pieces[S].id[0]+"Graveyard",!0),CHESSBOARD.move(e.target.id,CHESSBOARD.promoting[e.target.id[0]]),CHESSBOARD.selectedPiece="",CHESSBOARD.promoting[e.target.id[0]]=!1,!0}if("IMG"===e.target.tagName&&!CHESSBOARD.selectedPiece&&(e.target.id[0]!==CHESSBOARD.currentGameTurn||"wGraveyard"===CHESSBOARD.pieces[e.target.id].sqId||"bGraveyard"===CHESSBOARD.pieces[e.target.id].sqId||"w"===e.target.id[0]&&CHESSBOARD.whitePlayer!==CONTEXT.user||"b"===e.target.id[0]&&CHESSBOARD.blackPlayer!==CONTEXT.user))return!1;if("IMG"!==e.target.tagName||CHESSBOARD.selectedPiece){if("IMG"===e.target.tagName&&CHESSBOARD.selectedPiece&&CHESSBOARD.selectedPiece.attr("id")!==e.target.id&&CHESSBOARD.selectedPiece.attr("id")[0]===e.target.id[0])return CHESSBOARD._markSquare(CHESSBOARD.pieces[CHESSBOARD.selectedPiece.attr("id")].sqId,"selected",!1),CHESSBOARD.selectedPiece=$("#"+e.target.id),CHESSBOARD._markSquare(CHESSBOARD.pieces[e.target.id].sqId,"selected",!0),!0;if("IMG"===e.target.tagName&&CHESSBOARD.selectedPiece&&CHESSBOARD.selectedPiece.attr("id")===e.target.id)return CHESSBOARD._markSquare(CHESSBOARD.pieces[CHESSBOARD.selectedPiece.attr("id")].sqId,"selected",!1),CHESSBOARD.selectedPiece="",!0;if(("DIV"===e.target.tagName||"IMG"===e.target.tagName&&CHESSBOARD.selectedPiece.attr("id")[0]!==e.target.id[0]&&""!==CHESSBOARD.pieces[e.target.id].sqId)&&CHESSBOARD.selectedPiece){for(var s=e.target,r=CHESSBOARD.selectedPiece.attr("id");"DIV"!==s.tagName;)s=s.parentNode;var a=CHESSBOARD._canMove(r,s.id);if(!a)return!1;if(CHESSBOARD._isCheck(r,s.id))return!1;if("bking"===r||"wking"===r){var i=CHESSBOARD.pieces[r].sqId,t=parseInt(CHESSBOARD._numeric(i),10),n=parseInt(CHESSBOARD._numeric(s.id),10),c=n-t,C="",B="";20===c&&CHESSBOARD.whiteCanCastleKingSide&&"w"===r[0]?(C="wrookh",B="sqf1"):20===c&&CHESSBOARD.blackCanCastleKingSide&&"b"===r[0]?(C="brookh",B="sqf8"):-20===c&&CHESSBOARD.whiteCanCastleQueenSide&&"w"===r[0]?(C="wrooka",B="sqd1"):-20===c&&CHESSBOARD.blackCanCastleQueenSide&&"b"===r[0]&&(C="brooka",B="sqd8"),C&&B&&CHESSBOARD.move(C,B,!0)}return("wpawn"===CHESSBOARD.pieces[r].class&&"8"===s.id[3]||"bpawn"===CHESSBOARD.pieces[r].class&&"1"===s.id[3])&&(CHESSBOARD.promoting[r[0]]=s.id,CHESSBOARD._markSquare(r[0]+"Graveyard","selected",!0)),CHESSBOARD._markSquare(CHESSBOARD.pieces[CHESSBOARD.selectedPiece.attr("id")].sqId,"selected",!1),CHESSBOARD.move(r,s.id,CHESSBOARD.promoting[r[0]]?!0:!1),CHESSBOARD.selectedPiece="",!0}return console.log("Unhandled case : "+e.target.id),!1}return CHESSBOARD.selectedPiece=$("#"+e.target.id),CHESSBOARD._markSquare(CHESSBOARD.pieces[e.target.id].sqId,"selected",!0),!0},_commitMoves:function(){CHESSBOARD.arrayOfMoves.length>0&&CHESSHUB.sendMessage(JSON.stringify(CHESSBOARD.arrayOfMoves),CHESSBOARD.gameId,"game",function(){},function(e){console.log("error sending move"),console.log(e)}),CHESSBOARD.arrayOfMoves=[]},_canMove:function(e,S,s){var r=0,a="",i=CHESSBOARD.chessBoard[CHESSBOARD._numeric(S)],t=CHESSBOARD.pieces[e].sqId,n=parseInt(CHESSBOARD._numeric(t),10),c=parseInt(CHESSBOARD._numeric(S),10),C=c-n;switch(CHESSBOARD.pieces[e].type){case"pawn":return s||"w"!==e[0]||1!==C&&(2!==C||"2"!==t[3])?s||"b"!==e[0]||-1!==C&&(-2!==C||"7"!==t[3])?"w"===e[0]&&(11===C||-9===C)||"b"===e[0]&&(-11===C||9===C)?i||"wpawn"===CHESSBOARD.pieces[e].class&&"6"===S[3]&&CHESSBOARD.chessBoard[c-1]&&"bpawn"===CHESSBOARD.pieces[CHESSBOARD.chessBoard[c-1]].class&&CHESSBOARD.pieces[CHESSBOARD.chessBoard[c-1]].enPassant||"bpawn"===CHESSBOARD.pieces[e].class&&"3"===S[3]&&CHESSBOARD.chessBoard[c+1]&&"wpawn"===CHESSBOARD.pieces[CHESSBOARD.chessBoard[c+1]].class&&CHESSBOARD.pieces[CHESSBOARD.chessBoard[c+1]].enPassant?!0:!1:!1:i?!1:-2===C&&CHESSBOARD.chessBoard[n-1]?!1:!0:i?!1:2===C&&CHESSBOARD.chessBoard[n+1]?!1:!0;case"knight":return 21===C||-21===C||19===C||-19===C||12===C||-12===C||8===C||-8===C?!0:!1;case"bishop":if(0===C%11&&C>0&&parseInt(t[3],10)<parseInt(S[3],10)&&t[2]<S[2]||0===C%11&&0>C&&parseInt(t[3],10)>parseInt(S[3],10)&&t[2]>S[2]||0===C%9&&C>0&&parseInt(t[3],10)>parseInt(S[3],10)&&t[2]<S[2]||0===C%9&&0>C&&parseInt(t[3],10)<parseInt(S[3],10)&&t[2]>S[2]){for(0===C%11&&C>0?r=11:0===C%11&&0>C?r=-11:0===C%9&&C>0?r=9:0===C%9&&0>C&&(r=-9),a=n+r;c>a&&C>0||a>c&&0>C;a+=r)if(CHESSBOARD.chessBoard[a])return!1;return!0}return!1;case"rook":if(t[2]===S[2]||t[3]===S[3]){for(t[2]===S[2]&&C>0?r=1:t[2]===S[2]&&0>C?r=-1:t[3]===S[3]&&C>0?r=10:t[3]===S[3]&&0>C&&(r=-10),a=n+r;c>a&&C>0||a>c&&0>C;a+=r)if(CHESSBOARD.chessBoard[a])return!1;return!0}break;case"queen":if(0===C%11&&C>0&&parseInt(t[3],10)<parseInt(S[3],10)&&t[2]<S[2]||0===C%11&&0>C&&parseInt(t[3],10)>parseInt(S[3],10)&&t[2]>S[2]||0===C%9&&C>0&&parseInt(t[3],10)>parseInt(S[3],10)&&t[2]<S[2]||0===C%9&&0>C&&parseInt(t[3],10)<parseInt(S[3],10)&&t[2]>S[2]||t[2]===S[2]||t[3]===S[3]){for(0===C%11&&C>0?r=11:0===C%11&&0>C?r=-11:0===C%9&&C>0?r=9:0===C%9&&0>C?r=-9:t[2]===S[2]&&C>0?r=1:t[2]===S[2]&&0>C?r=-1:t[3]===S[3]&&C>0?r=10:t[3]===S[3]&&0>C&&(r=-10),a=n+r;c>a&&C>0||a>c&&0>C;a+=r)if(CHESSBOARD.chessBoard[a])return!1;return!0}break;case"king":if(r=0,1===C||-1===C||-11===C||11===C||-9===C||9===C||-10===C||10===C)return CHESSBOARD._isCheck(e,S)?!1:!0;if(CHESSBOARD._isCheck(e,t)||CHESSBOARD._isCheck(e,S))return!1;if(20===C&&CHESSBOARD.whiteCanCastleKingSide&&"w"===e[0]?r=10:20===C&&CHESSBOARD.blackCanCastleKingSide&&"b"===e[0]?r=10:-20===C&&CHESSBOARD.whiteCanCastleQueenSide&&"w"===e[0]?r=-10:-20===C&&CHESSBOARD.blackCanCastleQueenSide&&"b"===e[0]&&(r=-10),!r)return!1;for(a=n+r;c>=a&&C>0||a>=c&&0>C;a+=r)if(CHESSBOARD.chessBoard[a])return!1;return!0}return!1},_isCheck:function(e,S){var s=e[0],r=!1,a=CHESSBOARD.pieces[e].sqId,i=CHESSBOARD.chessBoard[CHESSBOARD._numeric(S)];if(CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.pieces[e].sqId)]="",CHESSBOARD.pieces[e].sqId=S,CHESSBOARD.chessBoard[CHESSBOARD._numeric(S)]=e,i&&(CHESSBOARD.pieces[i].sqId="out"),"wking"===e||"bking"===e)for(var t in CHESSBOARD.pieces)"king"!==CHESSBOARD.pieces[t].type&&"s"===CHESSBOARD.pieces[t].sqId[0]&&t[0]!==e[0]&&CHESSBOARD._canMove(t,S,!0)&&(r=t);else r=CHESSBOARD._isCheck(s+"king",CHESSBOARD.pieces[s+"king"].sqId)?!0:!1;return i&&(CHESSBOARD.pieces[i].sqId=S),CHESSBOARD.chessBoard[CHESSBOARD._numeric(a)]=e,CHESSBOARD.chessBoard[CHESSBOARD._numeric(S)]=i,CHESSBOARD.pieces[e].sqId=a,r},_verifyCheck:function(){var e=["bking","wking"];return CHESSBOARD._markSquare("ALL","check",!1),e.forEach(function(e){var S=CHESSBOARD._isCheck(e,CHESSBOARD.pieces[e].sqId);S?(CHESSBOARD._markSquare(CHESSBOARD.pieces[e].sqId,"check",!0),CHESSBOARD._markSquare(CHESSBOARD.pieces[S].sqId,"check",!0),CHESSBOARD.pieces[e].isCheck=!0):(CHESSBOARD._markSquare(CHESSBOARD.pieces[e].sqId,"check",!1),CHESSBOARD.pieces[e].isCheck=!1)}),!1},_createPieces:function(){for(var e in CHESSBOARD.colors){CHESSBOARD.pieces[e+"king"]={id:e+"king",type:"king",order:0,name:CHESSBOARD.colors[e]+" king","class":e+"king",sqId:"sqe"+("w"===e?1:8),initx:5,inity:"w"===e?1:8,isCheck:!1},CHESSBOARD.pieces[e+"queen"]={id:e+"queen",type:"queen",order:1,name:CHESSBOARD.colors[e]+" queen","class":e+"queen",sqId:"sqd"+("w"===e?1:8),initx:4,inity:"w"===e?1:8},CHESSBOARD.pieces[e+"rooka"]={id:e+"rooka",type:"rook",order:2,name:CHESSBOARD.colors[e]+" rook (a)","class":e+"rook",sqId:"sqa"+("w"===e?1:8),initx:1,inity:"w"===e?1:8},CHESSBOARD.pieces[e+"rookh"]={id:e+"rookh",type:"rook",order:3,name:CHESSBOARD.colors[e]+" rook (h)","class":e+"rook",sqId:"sqh"+("w"===e?1:8),initx:8,inity:"w"===e?1:8},CHESSBOARD.pieces[e+"knightb"]={id:e+"knightb",type:"knight",order:4,name:CHESSBOARD.colors[e]+" knight (b)","class":e+"knight",sqId:"sqb"+("w"===e?1:8),initx:2,inity:"w"===e?1:8},CHESSBOARD.pieces[e+"knightg"]={id:e+"knightg",type:"knight",order:2,name:CHESSBOARD.colors[e]+" knight (g)","class":e+"knight",sqId:"sqg"+("w"===e?1:8),initx:7,inity:"w"===e?1:8},CHESSBOARD.pieces[e+"bishopc"]={id:e+"bishopc",type:"bishop",order:6,name:CHESSBOARD.colors[e]+" bishop (c)","class":e+"bishop",sqId:"sqc"+("w"===e?1:8),initx:3,inity:"w"===e?1:8},CHESSBOARD.pieces[e+"bishopf"]={id:e+"bishopf",type:"bishop",order:7,name:CHESSBOARD.colors[e]+" bishop (f)","class":e+"bishop",sqId:"sqf"+("w"===e?1:8),initx:6,inity:"w"===e?1:8};for(var S in CHESSBOARD.chessBoardColumns)CHESSBOARD.pieces[e+"pawn"+CHESSBOARD.chessBoardColumns[S]]={id:e+"pawn"+CHESSBOARD.chessBoardColumns[S],type:"pawn",order:7+S,name:CHESSBOARD.colors[e]+" pawn ("+CHESSBOARD.chessBoardColumns[S]+")","class":e+"pawn",sqId:"sq"+CHESSBOARD.chessBoardColumns[S]+("w"===e?2:7),initx:S,inity:"w"===e?2:7}}CHESSBOARD.chessBoard={11:"",12:"",13:"",14:"",15:"",16:"",17:"",18:"",21:"",22:"",23:"",24:"",25:"",26:"",27:"",28:"",31:"",32:"",33:"",34:"",35:"",36:"",37:"",38:"",41:"",42:"",43:"",44:"",45:"",46:"",47:"",48:"",51:"",52:"",53:"",54:"",55:"",56:"",57:"",58:"",61:"",62:"",63:"",64:"",65:"",66:"",67:"",68:"",71:"",72:"",73:"",74:"",75:"",76:"",77:"",78:"",81:"",82:"",83:"",84:"",85:"",86:"",87:"",88:""};for(var s in CHESSBOARD.pieces)CHESSBOARD.chessBoard[CHESSBOARD._numeric(CHESSBOARD.pieces[s].sqId)]=CHESSBOARD.pieces[s].id},_spawnPieces:function(){var e=$("#bGraveyard"),S=$("#wGraveyard");for(var s in CHESSBOARD.pieces){var r='<img                         class="piece '+CHESSBOARD.pieces[s].class+'"                         src="/client/img/transparent.png"                         alt="'+CHESSBOARD.pieces[s].name+'"                         title="'+CHESSBOARD.pieces[s].name+'"                         id="'+CHESSBOARD.pieces[s].id+'">                   </img>';"w"===CHESSBOARD.pieces[s].id[0]&&""===CHESSBOARD.pieces[s].sqId?S.append(r):"b"===CHESSBOARD.pieces[s].id[0]&&""===CHESSBOARD.pieces[s].sqId?e.append(r):$("#"+CHESSBOARD.pieces[s].sqId).append(r)}$(".piece").bind("vmousedown",function(e){CHESSBOARD.mouseDownHandler(e)}).on("dragstart",function(e){e.preventDefault()})},_drawBoard:function(){var e=$("#chessBoard");for(var S in CHESSBOARD.chessBoardRows){var s='<div class="chessBoardRow">';for(var r in CHESSBOARD.chessBoardColumns)s+='<div title="'+CHESSBOARD.chessBoardColumns[r]+CHESSBOARD.chessBoardRows[S]+'"                             id="sq'+CHESSBOARD.chessBoardColumns[r]+CHESSBOARD.chessBoardRows[S]+'"                             class="chessBoardSquare chessBoardSquare'+(parseInt(r,10)+parseInt(S,10))%2+'"></div>';s+="</div>",e.append(s)}$(".chessBoardSquare").bind("vmousedown",function(e){CHESSBOARD.mouseDownHandler(e)})},initChessBoard:function(e){return CHESSBOARD.pieces=[],$("#chessBoard").empty(),$("#wGraveyard").empty(),$("#bGraveyard").empty(),$("#wSit").css("display","block"),$("#bSit").css("display","block"),CHESSBOARD._drawBoard(),CHESSBOARD._createPieces(),CHESSBOARD._spawnPieces(),CHESSBOARD.gameId=e,CHESSBOARD.playerA="",CHESSBOARD.playerB="",CHESSBOARD.blackPlayer="",CHESSBOARD.blackCanCastleKingSide=!0,CHESSBOARD.blackCanCastleQueenSide=!0,CHESSBOARD.whitePlayer="",CHESSBOARD.whiteCanCastleKingSide=!0,CHESSBOARD.whiteCanCastleQueenSide=!0,CHESSBOARD.currentGameTurn="",CHESSBOARD.gameHistory=[],0},sit:function(e){return $("#"+e+"Sit").css("display","none"),CHESSHUB.sendMessage("sit-"+e,CHESSBOARD.gameId,"game",function(){CHESSBOARD.setPlayer(e,CONTEXT.user),CHESSBOARD.flip(e)},function(){console.log("error while sitting")}),!0},setPlayer:function(e,S){"A"===e?CHESSBOARD.playerA=S:"B"===e?CHESSBOARD.playerB=S:"w"===e?(CHESSBOARD.whitePlayer=S,S?$("#wSit").css("display","none"):$("#wSit").css("display","block")):"b"===e&&(CHESSBOARD.blackPlayer=S,S?$("#bSit").css("display","none"):$("#bSit").css("display","block")),CHESSBOARD.blackPlayer&&CHESSBOARD.whitePlayer&&(CHESSBOARD.currentGameTurn||(CHESSBOARD.currentGameTurn="w"))}};